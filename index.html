<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Three.js Game Scene</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }

#seatName{
  position: absolute;
    bottom: 165px;
    right: 237px;
    font-family: 'Segoe UI', 'Roboto', sans-serif;
    font-size: 25px;
    font-weight: 400;
    line-height: 1.6;
    color: #faf6f6;
    font-weight: bold;


}

#price8{
position: absolute;
    bottom: 145px;
    right: 269px;
    font-family: 'Segoe UI', 'Roboto', sans-serif;
    font-size: 14px;
    font-weight: 400;
    line-height: 1.6;
    color: #faf6f6;

}

#SelectedSeat{

position: absolute;
    bottom: 210px;
    right: 252px;
    font-family: 'Segoe UI', 'Roboto', sans-serif;
    font-size: 16px;
    font-weight: 400;
    line-height: 1.6;
    color: #faf6f6;


}

#confirmMenu{
background: rgba(147, 130, 130, 0.6);
  border: 1px solid rgb(255, 255, 255);
  border-radius: 10px;
  padding: 17px, 40px;
  color: white;
  font-family: 'Segoe UI', sans-serif;

  margin: auto;
  position: absolute;
  top: 55%;
  left: 80%;
  width: 360px;
  height: 230px;
  transform: translateX(-50%);
  text-align: center;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);

}

 .menu {
  position: absolute;

  background: rgba(20, 20, 20, 0.8);
  padding: 20px;
  border-radius: 10px;
  color: white;
  font-family: sans-serif;
  z-index: 10;
  pointer-events: auto; /* ✅ allow button clicks */
}

.menu.hidden {
  display: none;
}

button {
  position: absolute;
  padding: 12px 24px;
  font-size: 14px;
  font-weight: bold;
  font-family: 'Segoe UI', sans-serif;
  border-radius: 6px;
  margin: 10px;
  cursor: pointer;
  transition: all 0.3s ease;

}

/* Green "Add to Cart" button */
#button1 {
  position: absolute;
  background-color: #68b874;
  color: black;
  font-size: 14px;
  font-weight: bold;
  font-family: 'Segoe UI', sans-serif;
  border-radius: 6px;
  bottom: 60px;
  right: 269px;

}

#button1:hover {
  background-color: #4faa5d;
  transform: scale(1.03);
}

/* Outline "Cancel" button */
#button2 {
  background: transparent;
  border: 1px solid white;
  color: white;
  bottom: 60px;
  right: 150px;
}

#button2:hover {
  background-color: rgba(255, 255, 255, 0.1);
  transform: scale(1.03)
}

  .menu button {
    margin: 5px;
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    background: #e20d0d;
    color: white;
    cursor: pointer;
  bottom: 80px;
  right: 269px;



  }

  .menu button:hover {
    background: #5a5a5a;
  }




  #Confirm{
    font-family: 'Segoe UI', 'Roboto', sans-serif;
    font-size: 16px;
    font-weight: 400;
    line-height: 1.6;
    color: #faf6f6;
      top: 10%;
      left: 50%;
        padding: 10px 10px;

    
  }


    #crosshair {
      --crosshair-color: white;
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin-left: -10px;
      margin-top: -10px;
      pointer-events: none;
      z-index: 100;
    }

    #crosshair:before, #crosshair:after {
      content: '';
      position: absolute;
      background: var(--crosshair-color, white);
    }

    #crosshair:before {
      left: 50%;
      top: 0;
      width: 2px;
      height: 100%;
      margin-left: -1px;
    }

    #crosshair:after {
      top: 50%;
      left: 0;
      width: 100%;
      height: 2px;
      margin-top: -1px;
    }

    #label {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 50px;
      pointer-events: none;
      z-index: 101;
      text-shadow: 0 0 5px black;
    }

    #label1{
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 20px;

    }

    #label2{
      position: absolute;
      top: 59%;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 15px;
    }


    #button3{
     position: absolute;
     background-color: #68b874;
     color: rgb(255, 255, 255);
     font-size: 14px;
     font-weight: bold;
     font-family: 'Segoe UI', sans-serif;
     border-radius: 6px;
     bottom: 60px;
     right: 30px;
     width: 200px;

    }

    #button4{
     position: absolute;
     background-color: transparent;
     font-weight: normal;

     color: rgb(255, 255, 255);
     font-size: 12px;
     bottom: 453px;
     right: 12px;
    }

    #paymentMenu{
    background: rgba(46, 44, 44, 0.474);
    border: 1px solid rgba(30, 28, 28, 0.771);
    border-radius: 10px;
    padding: 10px, 40px;
    color: white;
    font-family: 'Segoe UI', sans-serif;
    border: 1px solid rgb(255, 255, 255);
    margin: auto;
    position: absolute;
    top: 20%;
    left: 80%;
    width: 230px;
    height: 460px;
    transform: translateX(-50%);
    text-align: center;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);

    }



    #finalPrice{
   position: absolute;
      bottom: 265px;
      right: 10px;
   transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 15px;

    }

  #finalPrice1{
   position: absolute;
      bottom: 400px;
      right: 60px;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 20px;
      width: 80px;
    height: 20px;
    }



    #line{
      position: absolute;
      bottom: 300px;
      right: 120px;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 20px;
      width: 80px;
      height: 20px;


    }

    #line1{

      position: absolute;
      bottom: 250px;
      right: 120px;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 20px;
      width: 80px;
      height: 20px;
    }


    #line2{
      position: absolute;
      bottom: 200px;
      right: 120px;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 20px;
      width: 80px;
      height: 20px;
    }

    #fees{
      position: absolute;
      bottom: 210px;
      right: 130px;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 15px;
      width: 80px;
      height: 20px; 
    }


    #fees2{
      position: absolute;
      bottom: 210px;
      right: 10px;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 15px;

    }

    #subtotal{
      position: absolute;
      bottom: 265px;
      right: 146px;
      transform: translateX(-50%);
      color: white;
      font-family: sans-serif;
      font-size: 15px; 
    }


  </style>
</head>
<body>
  

<video id="video" loop muted playsinline style="display: none;">
  <source src="./paramount-logo.mp4" type="video/mp4" />
</video>


<!-- the first menuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu -->



<!-- Purchase Confirmation Menu -->
<div id="confirmMenu" class="menu hidden">

  <div id="Confirm"> </div>
  <div id="SelectedSeat">Selected seat </div>
  <div id="seatName">   </div>
  <div id="price8"> </div>

<button id="button1" onclick="confirmPurchase()">Confirm</button>
<button id="button2" onclick="closeMenus()">Cancel</button>

<!--  <button onclick="confirmPurchase()">Confirm</button>
  <button onclick="closeMenus()">Cancel</button>
-->

</div> 



<!-- Final Payment Menu -->
<div id="paymentMenu" class="menu hidden">
  <div id="finalPrice">Total: €0.00</div>

  <div id="finalPrice1"> </div>

  <button id="button3" onclick="proceedToPay()">PROCEED TO PAY</button>
  <button id="button4" onclick="closeMenuss()">close</button>


  <div id="line"> ____________________</div>
  <div id="line1"> ____________________</div>
  <div id="line2"> ____________________</div>


  <div id="fees">All fees </div>
  <div id="fees2">€2.50 </div>
  <div id="subtotal"> Subtotals </div>

  <div> </div>
</div>


  <div id="crosshair"></div>
  <div id="label"></div>
  <div id="label1"> </div>
  <div id="label2"> </div>

 <script type="module">
  import * as THREE from 'three';
  import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';
  import { AnimationMixer } from 'three';

  let seatInfo1=1;
  let price;
  let camera, scene, renderer, mixer;
  let clock = new THREE.Clock();
  const movement = { forward: false, back: false, left: false, right: false, up: false, down: false };
  const yawObject = new THREE.Object3D();
  const pitchObject = new THREE.Object3D();
  const loader = new GLTFLoader();
  let raycaster = new THREE.Raycaster();
  let mouse = new THREE.Vector2(0, 0);
  let selectedSeat = null;
  let menuOpen = false;
  let selectedSeatPrice = 0;

  //  These are now exposed globally
  window.confirmPurchase = function () {
    console.log("✅ Confirm clicked");
    document.getElementById('confirmMenu').classList.add('hidden');
    document.getElementById('finalPrice').textContent = ` €${selectedSeatPrice.toFixed(2)}`;
    document.getElementById('paymentMenu').classList.remove('hidden');
  };

  window.closeMenus = function () {
    document.getElementById('confirmMenu').classList.add('hidden');
    document.getElementById('paymentMenu').classList.add('hidden');
  };

  window.proceedToPay = function () {
    alert(`Redirecting to payment for €${selectedSeatPrice.toFixed(2)}...`);
    window.closeMenus();
  };

  function showConfirmMenu(price) {
    selectedSeatPrice = price;
    
    document.exitPointerLock();
    document.getElementById('confirmMenu').classList.remove('hidden');
 //   document.getElementById('seatName').textContent = `Chosen seat: €${seatName.toFixed(2)}...`;


  }


  init();
  animate();



// Create video texture and material
const video = document.getElementById("video");

window.addEventListener("click", () => {
  video.play().catch(console.error); // start on first click
});

const videoTexture = new THREE.VideoTexture(video);
videoTexture.minFilter = THREE.LinearFilter;
videoTexture.magFilter = THREE.LinearFilter;
videoTexture.format = THREE.RGBAFormat;

const videoMaterial = new THREE.MeshBasicMaterial({
  map: videoTexture,
  side: THREE.DoubleSide
});




    function init() {
      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
      camera.up.set(0, 1, 0);
      //camera.rotation.z = Math.PI; // upside down

      yawObject.add(pitchObject);
      pitchObject.add(camera);
      scene.add(yawObject);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0x111111);
      document.body.appendChild(renderer.domElement);

      const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 0.3);
      scene.add(hemi);

      const sun = new THREE.DirectionalLight(0xffffff, 0.4);
      sun.position.set(5, 10, 7);
      scene.add(sun);

      loader.load('/model.glb', (gltf) => {
        //gltf.scene.rotation.y = Math.PI; apversti
        scene.add(gltf.scene);

        gltf.scene.traverse((child) => {
          if (child.isMesh && child.material) {
            if (!child.name) child.name = 'SEAT_TEST';
             if (!child.name) child.name = 'Plane';

            if (child.name === 'Plane') {
             child.material = videoMaterial; // pply video texture to plane
             child.rotation.x = Math.PI/2 ;
             child.scale.x *= -1;

            console.log("✅ Video material applied to plane");
      }
          }
        });

        if (gltf.animations && gltf.animations.length) {
          mixer = new AnimationMixer(gltf.scene);
          gltf.animations.forEach((clip) => mixer.clipAction(clip).play());
        }
      });



      //aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa

      document.body.addEventListener('click', (e) => {
  // Only request pointer lock if clicking the canvas or empty area
  if (e.target === renderer.domElement) {
    document.body.requestPointerLock();
  }
});

      document.addEventListener('pointerlockchange', () => {
        if (document.pointerLockElement === document.body) {
          document.addEventListener('mousemove', onMouseMove, false);
        } else {
          document.removeEventListener('mousemove', onMouseMove, false);
        }
      });

      document.addEventListener('mousedown', (e) => {
  // Skip if clicking any UI element (like a menu or button)
        if (
            e.target.closest('.menu') ||     // menu container
            e.target.tagName === 'BUTTON' || // any button
             e.target.closest('button')       // just in case the button contains spans
            ) {
               return;
         }

  //  Only process 3D clicks if pointer lock is active
            if (document.pointerLockElement !== document.body) return;

  //  Raycasting logic for selecting seats
            raycaster.setFromCamera(mouse, camera);
              const intersects = raycaster.intersectObjects(scene.children, true);

             for (let i = 0; i < intersects.length; i++) {
             const obj = intersects[i].object;
            if (obj.name && obj.name.startsWith('SEAT')) {
      selectedSeat = obj;
      teleportToSeat(obj);

      let price = 25.00; // default price

      if (obj.name.startsWith('SEAT_B39')) price = 23.00;
      else if (obj.name.startsWith('SEAT_C31')) price = 29.99;
      else if (obj.name.startsWith('SEAT_D31')) price = 34.00;
      else if (obj.name.startsWith('SEAT_D1')) price = 28.00;
      else if (obj.name.startsWith('SEAT_Y24')) price = 34.00;
      else if (obj.name.startsWith('SEAT_Z41')) price = 40.00;
      else if (obj.name.startsWith('SEAT_Z27')) price = 40.00;

      showConfirmMenu(price);
      break;
    }
  }
});


      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      document.addEventListener('keydown', (e) => setKey(e.key.toLowerCase(), true));
      document.addEventListener('keyup', (e) => setKey(e.key.toLowerCase(), false));
    }


//TELEPORTING TO THE SEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAT

  function teleportToSeat(seat) {
  const position = new THREE.Vector3();
  seat.getWorldPosition(position);
  position.y += 1; // Raise camera a bit above the seat

  yawObject.position.copy(position);

  // Get seat's forward direction (local Z in world space)
  const forward = new THREE.Vector3(0, 0, 1);
  forward.applyQuaternion(seat.getWorldQuaternion(new THREE.Quaternion()));
  forward.normalize();

  // Calculating the angle the camera should face 
  const angle = Math.atan2(forward.x, forward.z);
  yawObject.rotation.y = angle + Math.PI+ Math.PI/2; // Turn 180 degres



}




function openMenu() {
  menuOpen = true;
  document.exitPointerLock();
  document.getElementById('menu').style.display = 'block';
}

function closeMenu() {
  menuOpen = false;
  document.getElementById('menu').style.display = 'none';
  document.body.requestPointerLock();
}

    function setKey(key, state) {
      if (key === 'w') movement.forward = state;
      if (key === 's') movement.back = state;
      if (key === 'a') movement.left = state;
      if (key === 'd') movement.right = state;
      if (key === 'q') movement.down = state;
      if (key === 'e') movement.up = state;
    }

    function onMouseMove(e) {
      yawObject.rotation.y -= e.movementX * 0.002;
      pitchObject.rotation.x -= e.movementY * 0.002;
      pitchObject.rotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, pitchObject.rotation.x));
    }

    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();

      if (mixer) mixer.update(delta);

      const velocity = new THREE.Vector3();
      const speed = 5;

      if (movement.forward) velocity.z -= 1;
      if (movement.back) velocity.z += 1;
      if (movement.left) velocity.x -= 1;
      if (movement.right) velocity.x += 1;
      if (movement.up) velocity.y += 1;
      if (movement.down) velocity.y -= 1;

      velocity.normalize().applyQuaternion(yawObject.quaternion);
      yawObject.position.addScaledVector(velocity, delta * speed);

      raycaster.setFromCamera(mouse, camera);
      const intersects = raycaster.intersectObjects(scene.children, true);
      const label = document.getElementById('label');
      const label1 = document.getElementById('label1');
      const label2 = document.getElementById('label2');
      const seatName = document.getElementById('seatName');
      const price8 = document.getElementById('price8');
      const finalPrice1 =document.getElementById('finalPrice1')
      
      let found = false;

      for (let i = 0; i < intersects.length; i++) {
        const obj = intersects[i].object;

        if (obj.name && obj.name.startsWith('SEAT_B39')) {

          label2.textContent = "Price - 23.00€";
          seatName.textContent='SEAT B39';
          price8.textContent ='Price: 23.00€'
          finalPrice1.textContent = 'Total: 25.50'
        }

        if (obj.name && obj.name.startsWith('SEAT_C31')) {
          label2.textContent = "Price - 29.99€";
          seatName.textContent='SEAT C31';
          price8.textContent ='Price: 29.99€'
          finalPrice1.textContent = 'Total: 32.49'

        }

         if (obj.name && obj.name.startsWith('SEAT_D31')) {
          label2.textContent = "Price - 34.00€";
          seatName.textContent='SEAT D31';
          price8.textContent ='Price: 34.00€'
          finalPrice1.textContent = 'Total: 36.50'

        }

         if (obj.name && obj.name.startsWith('SEAT_D1')) {
          label2.textContent = "Price - 28.00€";
          seatName.textContent='SEAT D1';
          price8.textContent ='Price: 28.00€'
          finalPrice1.textContent = 'Total: 30.50'

        }

        if (obj.name && obj.name.startsWith('SEAT_Y24')) {
          label2.textContent = "Price - 34.00€";
          seatName.textContent='SEAT Y24';
          price8.textContent ='Price: 34.00€'
          finalPrice1.textContent = 'Total: 36.50'
        }

          if (obj.name && obj.name.startsWith('SEAT_Z41')) {
          label2.textContent = "Price - 40.00€";
          seatName.textContent='SEAT Z41';
          price8.textContent ='Price: 40.00€'
          finalPrice1.textContent = 'Total: 42.50'
        }

          if (obj.name && obj.name.startsWith('SEAT_Z27')) {
          label2.textContent = "Price - 40.00€";
          seatName.textContent='SEAT Z27';
          price8.textContent ='Price: 40.00€'
          finalPrice1.textContent = 'Total: 42.50'
        }
        if (obj.name && obj.name.startsWith('Plane')) {
          label2.textContent = "Plane";

        }


        if (obj.name && obj.name.startsWith('SEAT')) {
          label.textContent = obj.name.replace(/_/g, ' ').slice(0, 8);
          label1.textContent = "Click to order";

          found = true;
          break;
        }
      }

      if (!found) label.textContent = '';
      if (!found) label1.textContent = '';
      if (!found) label2.textContent = '';

      renderer.render(scene, camera);
    }


  </script>
</body>
</html>

















